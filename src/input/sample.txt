view: fb_ad {

  dimension: account_id {
    sql: ${TABLE}.account_id ;;
  }

  dimension_group: date {
    type: time
    timeframes: [
      raw,
      date,
    ]
    convert_tz: no
    datatype: date
    sql: ${TABLE}.date ;;
  }

  parameter: usage_date_filter {
    label: "集計粒度"
    type: string
    default_value: "date"
    allowed_value: {
      label: "Day"
      value: "date"
    }
    allowed_value: {
      label: "Week"
      value: "week"
    }
    allowed_value: {
      label: "Month"
      value: "month"
    }
  }

  dimension: link_click {
    sql: SAFE_CAST(${TABLE}.link_clicks as numeric) ;;
  }

  measure: link_click_sum {
    type: sum
    sql: ${link_click} ;;
  }

  filter: limit_term {
    hidden: no
    type: date
    datatype: date
    label: "集計期間"
    sql: {% condition limit_term %} ${date_raw} {% endcondition %}
          {% if compare_term._is_filtered %}
            OR
            (
              (${date_raw} >= DATE_SUB({% date_start limit_term %}, interval 1 {% parameter compare_term %}))
              AND
              (${date_raw} < DATE_SUB({% date_end limit_term %}, interval 1 {% parameter compare_term %}))
            )
          {% endif %}
          ;;
  }
}
